<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>AI 토론 시스템</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', '맑은 고딕', sans-serif;
      background: #0d1117;
      color: #e6edf3;
      height: 100vh;
      height: 100dvh;
      display: flex;
      flex-direction: column;
    }

    /* ─── 헤더 ─── */
    .header {
      background: #161b22;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 1px solid #30363d;
      flex-shrink: 0;
    }

    .header h1 { font-size: 17px; font-weight: 700; }
    .header-badge {
      font-size: 11px;
      background: #238636;
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-weight: 600;
    }

    .header-actions {
      margin-left: auto;
      display: flex;
      gap: 8px;
    }

    .header-btn {
      background: #21262d;
      border: 1px solid #30363d;
      color: #8b949e;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .header-btn:hover { color: #e6edf3; border-color: #58a6ff; }

    /* ─── 채팅 영역 ─── */
    .chat-area {
      flex: 1;
      overflow-y: auto;
      padding: 20px 16px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .chat-area::-webkit-scrollbar { width: 6px; }
    .chat-area::-webkit-scrollbar-track { background: transparent; }
    .chat-area::-webkit-scrollbar-thumb { background: #30363d; border-radius: 3px; }

    /* ─── 사용자 메시지 ─── */
    .message-user {
      align-self: flex-end;
      display: flex;
      gap: 10px;
      flex-direction: row-reverse;
      max-width: 80%;
      animation: fadeIn 0.25s ease;
    }

    .message-user .avatar {
      width: 36px; height: 36px; border-radius: 50%;
      background: #1f6feb; display: flex; align-items: center;
      justify-content: center; font-weight: 700; font-size: 14px; flex-shrink: 0;
    }

    .message-user .bubble {
      background: #1f6feb;
      padding: 12px 16px;
      border-radius: 16px;
      border-bottom-right-radius: 4px;
      font-size: 14.5px;
      line-height: 1.55;
      word-break: break-word;
      white-space: pre-wrap;
    }

    /* ─── AI 토론 결과 블록 ─── */
    .discussion-block {
      align-self: flex-start;
      width: 100%;
      max-width: 90%;
      animation: fadeIn 0.25s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* 최종 합의 */
    .final-answer {
      background: #161b22;
      border: 1px solid #238636;
      border-radius: 12px;
      padding: 16px;
    }

    .final-answer-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
      font-size: 13px;
      font-weight: 700;
      color: #58a6ff;
    }

    .final-answer-header .icon { font-size: 16px; }

    .final-answer-body {
      font-size: 14.5px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .final-answer .msg-time {
      font-size: 11px;
      color: #484f58;
      margin-top: 10px;
      text-align: right;
    }

    /* 토론 과정 토글 */
    .discussion-toggle {
      margin-top: 10px;
      background: none;
      border: 1px solid #30363d;
      border-radius: 8px;
      color: #8b949e;
      padding: 8px 14px;
      font-size: 13px;
      cursor: pointer;
      width: 100%;
      text-align: left;
      transition: all 0.15s;
    }

    .discussion-toggle:hover { color: #e6edf3; border-color: #58a6ff; }

    .discussion-detail {
      display: none;
      margin-top: 12px;
      border-left: 2px solid #30363d;
      padding-left: 14px;
    }

    .discussion-detail.open { display: block; }

    .round-section {
      margin-bottom: 16px;
    }

    .round-title {
      font-size: 12px;
      font-weight: 700;
      color: #f0883e;
      margin-bottom: 10px;
      text-transform: uppercase;
    }

    .ai-response {
      background: #0d1117;
      border: 1px solid #21262d;
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 8px;
    }

    .ai-response-header {
      font-size: 12px;
      font-weight: 700;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .ai-response-header.claude { color: #d2a8ff; }
    .ai-response-header.gpt { color: #7ee787; }
    .ai-response-header.gemini { color: #79c0ff; }

    .ai-dot {
      width: 8px; height: 8px; border-radius: 50%; display: inline-block;
    }

    .ai-dot.claude { background: #d2a8ff; }
    .ai-dot.gpt { background: #7ee787; }
    .ai-dot.gemini { background: #79c0ff; }

    .ai-response-body {
      font-size: 13.5px;
      line-height: 1.55;
      color: #b1bac4;
      white-space: pre-wrap;
      word-break: break-word;
    }

    /* ─── 진행 상태 ─── */
    .progress-block {
      align-self: flex-start;
      width: 100%;
      max-width: 90%;
      animation: fadeIn 0.25s ease;
    }

    .progress-bar {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 12px;
      padding: 16px;
    }

    .progress-step {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 6px 0;
      font-size: 13px;
      color: #484f58;
    }

    .progress-step.active { color: #58a6ff; font-weight: 600; }
    .progress-step.done { color: #238636; }

    .progress-step .spinner {
      width: 16px; height: 16px;
      border: 2px solid #30363d;
      border-top-color: #58a6ff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .progress-step .check { color: #238636; font-weight: 700; }

    /* ─── 시스템 메시지 ─── */
    .system-msg {
      text-align: center;
      font-size: 13px;
      color: #484f58;
      padding: 8px;
    }

    /* ─── 입력 영역 ─── */
    .input-area {
      background: #161b22;
      padding: 14px 16px;
      display: flex;
      gap: 10px;
      align-items: flex-end;
      border-top: 1px solid #30363d;
      flex-shrink: 0;
    }

    .input-area textarea {
      flex: 1;
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 20px;
      padding: 10px 16px;
      color: #e6edf3;
      font-size: 15px;
      font-family: inherit;
      resize: none;
      max-height: 120px;
      outline: none;
      line-height: 1.4;
    }

    .input-area textarea:focus { border-color: #58a6ff; }
    .input-area textarea::placeholder { color: #484f58; }

    .send-btn {
      width: 44px; height: 44px;
      background: #238636; border: none; border-radius: 50%;
      color: white; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0; transition: all 0.15s;
    }

    .send-btn:hover { background: #2ea043; }
    .send-btn:active { transform: scale(0.93); }
    .send-btn:disabled { background: #21262d; cursor: not-allowed; }

    /* ─── 설정 모달 ─── */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.6);
      display: flex; align-items: center; justify-content: center;
      z-index: 100; backdrop-filter: blur(4px);
    }

    .modal {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 16px;
      padding: 28px 24px;
      width: min(92%, 440px);
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal h2 { font-size: 18px; margin-bottom: 8px; }
    .modal p { font-size: 13px; color: #8b949e; margin-bottom: 20px; line-height: 1.5; }

    .modal label {
      display: flex; align-items: center; gap: 8px;
      font-size: 13px; font-weight: 600; color: #8b949e;
      margin-bottom: 6px; margin-top: 16px;
    }

    .modal input {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid #30363d;
      border-radius: 10px;
      background: #0d1117;
      color: #e6edf3;
      font-size: 14px;
      outline: none;
    }

    .modal input:focus { border-color: #58a6ff; }

    .modal .btn-row {
      display: flex; gap: 10px; margin-top: 24px;
    }

    .modal .btn-primary {
      flex: 1; padding: 11px;
      background: #238636; border: none; border-radius: 10px;
      color: white; font-size: 14px; font-weight: 600; cursor: pointer;
    }

    .modal .btn-primary:hover { background: #2ea043; }

    .modal .btn-secondary {
      padding: 11px 18px;
      background: #21262d; border: 1px solid #30363d; border-radius: 10px;
      color: #8b949e; font-size: 14px; cursor: pointer;
    }

    .hidden { display: none !important; }

    @media (max-width: 600px) {
      .message-user { max-width: 92%; }
      .discussion-block { max-width: 100%; }
      .header h1 { font-size: 15px; }
      .header-btn span { display: none; }
    }
  </style>
</head>
<body>

  <!-- 설정 모달 -->
  <div class="modal-overlay hidden" id="settingsModal">
    <div class="modal">
      <h2>API 키 설정</h2>
      <p>3개 AI 모델의 API 키를 각각 입력하세요. 키는 브라우저에만 저장됩니다.</p>

      <label><span class="ai-dot claude"></span> Anthropic (Claude)</label>
      <input type="password" id="keyAnthropic" placeholder="sk-ant-..." autocomplete="off">

      <label><span class="ai-dot gpt"></span> OpenAI (ChatGPT)</label>
      <input type="password" id="keyOpenAI" placeholder="sk-..." autocomplete="off">

      <label><span class="ai-dot gemini"></span> Google (Gemini)</label>
      <input type="password" id="keyGoogle" placeholder="AI..." autocomplete="off">

      <div class="btn-row">
        <button class="btn-secondary" onclick="closeSettings()">취소</button>
        <button class="btn-primary" onclick="saveSettings()">저장</button>
      </div>
    </div>
  </div>

  <!-- 헤더 -->
  <div class="header">
    <h1>AI 토론</h1>
    <span class="header-badge">Claude + GPT + Gemini</span>
    <div class="header-actions">
      <button class="header-btn" onclick="openSettings()">&#9881; <span>설정</span></button>
      <button class="header-btn" onclick="clearChat()">&#128465; <span>초기화</span></button>
    </div>
  </div>

  <!-- 채팅 영역 -->
  <div class="chat-area" id="chatArea">
    <div class="system-msg">질문을 입력하면 Claude, ChatGPT, Gemini가 토론 후 합의된 답변을 제공합니다</div>
  </div>

  <!-- 입력 -->
  <div class="input-area">
    <textarea id="msgInput" rows="1" placeholder="질문을 입력하세요..."></textarea>
    <button class="send-btn" id="sendBtn" onclick="sendMessage()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <line x1="22" y1="2" x2="11" y2="13"></line>
        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
      </svg>
    </button>
  </div>

  <script>
    const chatArea = document.getElementById('chatArea');
    const msgInput = document.getElementById('msgInput');
    const sendBtn = document.getElementById('sendBtn');

    let settings = JSON.parse(localStorage.getItem('ai_debate_settings') || '{}');

    // 첫 접속 시 API 키가 없으면 자동으로 설정 모달 열기
    if (!settings.anthropicKey || !settings.openaiKey || !settings.googleKey) {
      document.getElementById('settingsModal').classList.remove('hidden');
    }

    // ─── 설정 ───
    function openSettings() {
      document.getElementById('settingsModal').classList.remove('hidden');
      document.getElementById('keyAnthropic').value = settings.anthropicKey || '';
      document.getElementById('keyOpenAI').value = settings.openaiKey || '';
      document.getElementById('keyGoogle').value = settings.googleKey || '';
    }

    function closeSettings() {
      document.getElementById('settingsModal').classList.add('hidden');
    }

    function saveSettings() {
      settings.anthropicKey = document.getElementById('keyAnthropic').value.trim();
      settings.openaiKey = document.getElementById('keyOpenAI').value.trim();
      settings.googleKey = document.getElementById('keyGoogle').value.trim();
      localStorage.setItem('ai_debate_settings', JSON.stringify(settings));
      closeSettings();
      addSystemMessage('API 키가 저장되었습니다.');
    }

    // ─── API 호출 함수 ───
    async function callClaude(messages) {
      const chatMsgs = messages.filter(m => m.role !== 'system');
      const systemMsg = messages.find(m => m.role === 'system');
      const body = {
        model: 'claude-sonnet-4-5-20250929',
        max_tokens: 4096,
        messages: chatMsgs
      };
      if (systemMsg) body.system = systemMsg.content;

      const res = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-api-key': settings.anthropicKey,
          'anthropic-version': '2023-06-01',
          'anthropic-dangerous-direct-browser-access': 'true'
        },
        body: JSON.stringify(body)
      });
      const data = await res.json();
      if (data.error) throw new Error('Claude: ' + data.error.message);
      return data.content[0].text;
    }

    async function callGPT(messages) {
      const res = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + settings.openaiKey
        },
        body: JSON.stringify({
          model: 'gpt-4o',
          messages: messages,
          max_tokens: 4096
        })
      });
      const data = await res.json();
      if (data.error) throw new Error('GPT: ' + data.error.message);
      return data.choices[0].message.content;
    }

    async function callGemini(messages, retries = 2) {
      const contents = messages
        .filter(m => m.role !== 'system')
        .map(m => ({
          role: m.role === 'assistant' ? 'model' : 'user',
          parts: [{ text: m.content }]
        }));

      const systemMsg = messages.find(m => m.role === 'system');
      const body = { contents };
      if (systemMsg) {
        body.systemInstruction = { parts: [{ text: systemMsg.content }] };
      }

      const res = await fetch(
        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${settings.googleKey}`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        }
      );
      const data = await res.json();
      if (data.error) {
        // 429 Rate Limit: 대기 후 재시도
        if (res.status === 429 && retries > 0) {
          await new Promise(resolve => setTimeout(resolve, 5000));
          return callGemini(messages, retries - 1);
        }
        throw new Error('Gemini: ' + data.error.message);
      }
      return data.candidates[0].content.parts[0].text;
    }

    // ─── 메시지 전송 & 토론 ───
    let isSending = false;

    async function sendMessage() {
      const text = msgInput.value.trim();
      if (!text || isSending) return;

      if (!settings.anthropicKey || !settings.openaiKey || !settings.googleKey) {
        addSystemMessage('설정에서 3개 API 키를 모두 입력해주세요.');
        openSettings();
        return;
      }

      isSending = true;
      sendBtn.disabled = true;

      // 사용자 메시지 표시
      appendUserMessage(text);
      msgInput.value = '';
      msgInput.style.height = 'auto';

      // 진행 상태 블록
      const progressEl = createProgressBlock();
      chatArea.appendChild(progressEl);
      scrollToBottom();

      const round1 = { claude: '', gpt: '', gemini: '' };
      const round2 = { claude: '', gpt: '', gemini: '' };
      let finalAnswer = '';

      try {
        // ── Round 1: 개별 답변 ──
        updateProgress(progressEl, 1);
        const userMessages = [{ role: 'user', content: text }];

        const [r1Claude, r1GPT, r1Gemini] = await Promise.all([
          callClaude(userMessages).catch(e => '(오류: ' + e.message + ')'),
          callGPT(userMessages).catch(e => '(오류: ' + e.message + ')'),
          callGemini(userMessages).catch(e => '(오류: ' + e.message + ')')
        ]);

        round1.claude = r1Claude;
        round1.gpt = r1GPT;
        round1.gemini = r1Gemini;

        // ── Round 2: 상호 검토 ──
        updateProgress(progressEl, 2);

        // Gemini 속도 제한 방지: Round 1 후 3초 대기
        await new Promise(resolve => setTimeout(resolve, 3000));

        const reviewPrompt = (myName, myAnswer, others) =>
          `사용자의 질문: "${text}"

당신(${myName})의 답변:
${myAnswer}

다른 AI들의 답변:
${others}

위 답변들을 검토하세요:
1. 다른 AI들의 답변에서 틀린 부분이나 부정확한 점을 지적하세요
2. 보완할 점이 있으면 제시하세요
3. 당신의 원래 답변에서 수정할 부분이 있으면 수정하세요
간결하게 핵심만 작성하세요.`;

        const [r2Claude, r2GPT, r2Gemini] = await Promise.all([
          callClaude([{ role: 'user', content: reviewPrompt('Claude', round1.claude,
            `[ChatGPT]: ${round1.gpt}\n\n[Gemini]: ${round1.gemini}`) }])
            .catch(e => '(오류: ' + e.message + ')'),
          callGPT([{ role: 'user', content: reviewPrompt('ChatGPT', round1.gpt,
            `[Claude]: ${round1.claude}\n\n[Gemini]: ${round1.gemini}`) }])
            .catch(e => '(오류: ' + e.message + ')'),
          callGemini([{ role: 'user', content: reviewPrompt('Gemini', round1.gemini,
            `[Claude]: ${round1.claude}\n\n[ChatGPT]: ${round1.gpt}`) }])
            .catch(e => '(오류: ' + e.message + ')')
        ]);

        round2.claude = r2Claude;
        round2.gpt = r2GPT;
        round2.gemini = r2Gemini;

        // ── Round 3: 최종 합의 ──
        updateProgress(progressEl, 3);

        const consensusPrompt = `사용자의 질문: "${text}"

=== Round 1: 개별 답변 ===
[Claude]: ${round1.claude}

[ChatGPT]: ${round1.gpt}

[Gemini]: ${round1.gemini}

=== Round 2: 상호 검토 ===
[Claude의 검토]: ${round2.claude}

[ChatGPT의 검토]: ${round2.gpt}

[Gemini의 검토]: ${round2.gemini}

위 3개 AI의 답변과 상호 검토 내용을 종합하여, 최종 합의된 답변을 작성하세요.
- 3개 AI가 동의하는 부분을 중심으로
- 검토 과정에서 수정된 내용을 반영
- 의견이 갈리는 부분은 각 입장을 명시
- 명확하고 정리된 형태로 작성`;

        finalAnswer = await callClaude([{ role: 'user', content: consensusPrompt }]);

        // 진행 상태 제거 → 결과 표시
        progressEl.remove();
        appendDiscussionBlock(finalAnswer, round1, round2);

      } catch (err) {
        progressEl.remove();
        addSystemMessage('오류: ' + err.message);
      }

      isSending = false;
      sendBtn.disabled = false;
      msgInput.focus();
    }

    // ─── UI 함수 ───
    function appendUserMessage(text) {
      const div = document.createElement('div');
      div.className = 'message-user';
      div.innerHTML = `
        <div class="avatar">나</div>
        <div class="bubble">${escapeHtml(text)}</div>`;
      chatArea.appendChild(div);
      scrollToBottom();
    }

    function appendDiscussionBlock(finalText, round1, round2) {
      const id = 'disc-' + Date.now();
      const div = document.createElement('div');
      div.className = 'discussion-block';

      div.innerHTML = `
        <div class="final-answer">
          <div class="final-answer-header">
            <span class="icon">&#9878;</span> 최종 합의 답변
          </div>
          <div class="final-answer-body">${escapeHtml(finalText)}</div>
          <div class="msg-time">${getNow()}</div>
        </div>
        <button class="discussion-toggle" onclick="toggleDetail('${id}')">
          &#9654; 토론 과정 보기
        </button>
        <div class="discussion-detail" id="${id}">
          <div class="round-section">
            <div class="round-title">Round 1 — 개별 답변</div>
            <div class="ai-response">
              <div class="ai-response-header claude"><span class="ai-dot claude"></span> Claude</div>
              <div class="ai-response-body">${escapeHtml(round1.claude)}</div>
            </div>
            <div class="ai-response">
              <div class="ai-response-header gpt"><span class="ai-dot gpt"></span> ChatGPT</div>
              <div class="ai-response-body">${escapeHtml(round1.gpt)}</div>
            </div>
            <div class="ai-response">
              <div class="ai-response-header gemini"><span class="ai-dot gemini"></span> Gemini</div>
              <div class="ai-response-body">${escapeHtml(round1.gemini)}</div>
            </div>
          </div>
          <div class="round-section">
            <div class="round-title">Round 2 — 상호 검토</div>
            <div class="ai-response">
              <div class="ai-response-header claude"><span class="ai-dot claude"></span> Claude의 검토</div>
              <div class="ai-response-body">${escapeHtml(round2.claude)}</div>
            </div>
            <div class="ai-response">
              <div class="ai-response-header gpt"><span class="ai-dot gpt"></span> ChatGPT의 검토</div>
              <div class="ai-response-body">${escapeHtml(round2.gpt)}</div>
            </div>
            <div class="ai-response">
              <div class="ai-response-header gemini"><span class="ai-dot gemini"></span> Gemini의 검토</div>
              <div class="ai-response-body">${escapeHtml(round2.gemini)}</div>
            </div>
          </div>
        </div>`;

      chatArea.appendChild(div);
      scrollToBottom();
    }

    function toggleDetail(id) {
      const el = document.getElementById(id);
      const btn = el.previousElementSibling;
      el.classList.toggle('open');
      btn.innerHTML = el.classList.contains('open')
        ? '&#9660; 토론 과정 접기'
        : '&#9654; 토론 과정 보기';
      scrollToBottom();
    }

    function createProgressBlock() {
      const div = document.createElement('div');
      div.className = 'progress-block';
      div.innerHTML = `
        <div class="progress-bar">
          <div class="progress-step active" id="ps1">
            <div class="spinner"></div>
            Round 1: AI들이 답변 중...
          </div>
          <div class="progress-step" id="ps2">
            <span style="width:16px;text-align:center;color:#30363d">○</span>
            Round 2: 서로 검토 중...
          </div>
          <div class="progress-step" id="ps3">
            <span style="width:16px;text-align:center;color:#30363d">○</span>
            Round 3: 최종 합의 중...
          </div>
        </div>`;
      return div;
    }

    function updateProgress(el, step) {
      for (let i = 1; i <= 3; i++) {
        const ps = el.querySelector('#ps' + i);
        if (!ps) continue;
        if (i < step) {
          ps.className = 'progress-step done';
          ps.querySelector('div, span').outerHTML = '<span class="check" style="width:16px;text-align:center">&#10003;</span>';
        } else if (i === step) {
          ps.className = 'progress-step active';
          const indicator = ps.querySelector('div, span');
          if (indicator) indicator.outerHTML = '<div class="spinner"></div>';
        }
      }
      scrollToBottom();
    }

    function addSystemMessage(text) {
      const div = document.createElement('div');
      div.className = 'system-msg';
      div.textContent = text;
      chatArea.appendChild(div);
      scrollToBottom();
    }

    function clearChat() {
      chatArea.innerHTML = '<div class="system-msg">대화가 초기화되었습니다</div>';
    }

    function scrollToBottom() {
      chatArea.scrollTop = chatArea.scrollHeight;
    }

    function getNow() {
      return new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
    }

    function escapeHtml(str) {
      const d = document.createElement('div');
      d.textContent = str;
      return d.innerHTML;
    }

    // 텍스트 영역 자동 높이
    msgInput.addEventListener('input', () => {
      msgInput.style.height = 'auto';
      msgInput.style.height = Math.min(msgInput.scrollHeight, 120) + 'px';
    });

    // Enter 전송, Shift+Enter 줄바꿈
    msgInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
  </script>
</body>
</html>
